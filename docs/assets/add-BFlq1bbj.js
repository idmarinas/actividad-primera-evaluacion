import{p as _,q as h,d as A,o as a,c as p,g as M,w as b,b as V,F as U,j as D,t as F,s as I,v as O,x as j,a as n,y as f,e as u,_ as N,u as R,z as G,h as q,A as H}from"./index-CiHmLYYs.js";import{A as J}from"./add-BUc0vYBO.js";import{_ as W}from"./alert-DkUmlB1v.js";import{a as K,u as Q}from"./orders-DBdjHSAn.js";const X={class:"space-y-1"},Y={class:"col-span-2 flex gap-3 items-center"},Z={key:1,class:"flex-1 flex gap-0"},ee={class:"col-span-full"},se={class:"col-span-full grid grid-cols-3 gap-3"},le={class:"flex gap-3 items-center"},ne={class:"flex gap-3 items-center"},ie={class:"flex gap-3 items-center"},oe={class:"flex gap-3 items-center"},de={class:"flex gap-3 items-center"},te={class:"flex gap-3 items-center"},re={__name:"piece",props:_({isEdit:Boolean},{id:{},idModifiers:{},order:{},orderModifiers:{},dimensionsLength:{},dimensionsLengthModifiers:{},dimensionsWidth:{},dimensionsWidthModifiers:{},dimensionsThickness:{},dimensionsThicknessModifiers:{},color:{},colorModifiers:{},bothFaces:{type:Boolean},bothFacesModifiers:{},cut:{type:Boolean},cutModifiers:{},errors:{},errorsModifiers:{}}),emits:["update:id","update:order","update:dimensionsLength","update:dimensionsWidth","update:dimensionsThickness","update:color","update:bothFaces","update:cut","update:errors"],setup(v){const S=K(),z=v,y=h(v,"id"),k=h(v,"order"),i=h(v,"dimensionsLength"),T=h(v,"dimensionsWidth"),L=h(v,"dimensionsThickness"),E=h(v,"color"),C=h(v,"bothFaces",{set:g=>!!g}),$=h(v,"cut",{set:g=>!!g}),l=h(v,"errors"),B=A(()=>{let g=!0;for(let s in l.value)if(s==="dimensions")for(let w in l.value[s])l.value[s][w].length>0&&(g=!1);else l.value[s].length>0&&(g=!1);return g});function P(){y.value=S.generatePieceId()}return(g,s)=>{var w,m,e,t,c,x,o;return a(),p(U,null,[B.value?I("",!0):(a(),M(W,{key:0,type:"error",class:"col-span-full"},{title:b(()=>s[10]||(s[10]=[V(" La información de la pieza contiene errores ")])),default:b(()=>[(a(!0),p(U,null,D(l.value,d=>(a(),p("div",X,[(a(!0),p(U,null,D(d,r=>(a(),p("div",null,F(typeof r=="string"?r:r[0]),1))),256))]))),256))]),_:1})),O(n("input",{type:"hidden","onUpdate:modelValue":s[0]||(s[0]=d=>k.value=d)},null,512),[[j,k.value]]),n("div",Y,[s[12]||(s[12]=n("label",{for:"piece_id"},"Nº de pedido",-1)),z.isEdit?(a(),M(f,{key:0,error:((m=(w=l.value)==null?void 0:w.id)==null?void 0:m.length)>0,type:"number",readonly:"",class:"rounded-lg flex-1",id:"piece_id",modelValue:y.value,"onUpdate:modelValue":s[1]||(s[1]=d=>y.value=d)},null,8,["error","modelValue"])):(a(),p("div",Z,[u(f,{error:l.value.id.length>0,type:"number",readonly:"",class:"rounded-l-lg flex-1",id:"piece_id",modelValue:y.value,"onUpdate:modelValue":s[2]||(s[2]=d=>y.value=d)},null,8,["error","modelValue"]),u(N,{class:"rounded-r-lg",onClick:s[3]||(s[3]=d=>P()),disabled:y.value!==void 0},{default:b(()=>s[11]||(s[11]=[V("Generar")])),_:1},8,["disabled"])]))]),n("div",ee,[s[16]||(s[16]=n("h5",null,"Dimensiones",-1)),n("div",se,[n("div",le,[s[13]||(s[13]=n("label",{for:"piece_dimensions_length"},"Largo (cm)",-1)),u(f,{error:((t=(e=l.value)==null?void 0:e.dimensions.length)==null?void 0:t.length)>0,class:"rounded-lg flex-1",type:"number",id:"piece_dimensions_length",modelValue:i.value,"onUpdate:modelValue":s[4]||(s[4]=d=>i.value=d),step:"1"},null,8,["error","modelValue"])]),n("div",ne,[s[14]||(s[14]=n("label",{for:"piece_dimensions_width"},"Ancho (cm)",-1)),u(f,{error:((c=l.value)==null?void 0:c.dimensions.width.length)>0,class:"rounded-lg flex-1",type:"number",id:"piece_dimensions_width",modelValue:T.value,"onUpdate:modelValue":s[5]||(s[5]=d=>T.value=d),step:"1"},null,8,["error","modelValue"])]),n("div",ie,[s[15]||(s[15]=n("label",{for:"piece_dimensions_thickness"},"Grosor (cm)",-1)),u(f,{error:((x=l.value)==null?void 0:x.dimensions.thickness.length)>0,class:"rounded-lg flex-1",type:"number",id:"piece_dimensions_thickness",modelValue:L.value,"onUpdate:modelValue":s[6]||(s[6]=d=>L.value=d),step:"1"},null,8,["error","modelValue"])])])]),n("div",oe,[s[17]||(s[17]=n("label",{for:"piece_color"},"Color chapado",-1)),u(f,{error:((o=l.value)==null?void 0:o.color.length)>0,class:"rounded-lg flex-1",type:"text",id:"piece_color",modelValue:E.value,"onUpdate:modelValue":s[7]||(s[7]=d=>E.value=d)},null,8,["error","modelValue"])]),n("div",de,[u(f,{type:"checkbox",id:"piece_bothFaces",modelValue:C.value,"onUpdate:modelValue":s[8]||(s[8]=d=>C.value=d)},null,8,["modelValue"]),s[18]||(s[18]=n("label",{for:"piece_bothFaces"},"¿Ambas caras?",-1))]),n("div",te,[u(f,{type:"checkbox",id:"piece_cut",modelValue:$.value,"onUpdate:modelValue":s[9]||(s[9]=d=>$.value=d)},null,8,["modelValue"]),s[19]||(s[19]=n("label",{for:"piece_cut"},"¿Cortada?",-1))])],64)}}},ae={class:"space-y-1"},ue={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},me={class:"flex gap-3 items-center"},pe={key:1,class:"flex-1 flex gap-0"},ce={class:"flex gap-3 items-center"},fe={class:"flex gap-3 items-center"},ve={class:"flex gap-3 items-center"},ge={class:"flex-1"},he={class:"flex gap-3 items-center"},be={class:"col-span-full flex items-center gap-3"},ye={key:0,class:"flex-1 text-red-700"},Ve={class:"col-span-full grid grid-cols-1 divide-y-2 divide-gold-sand-500"},ke={class:"col-span-full flex gap-3 mb-3"},we={__name:"add",props:{id:String},setup(v){const S=H(),z=R(),y=v,k=Q(),i=G(k.find(y.id));i.value.served=i.value.serverd!==void 0;function T(){i.value.id=k.generateOrderId()}function L(){return i.value.id!==void 0}const E=L();function C(){var t,c;if(((c=(t=i.value)==null?void 0:t.pieces)==null?void 0:c.length)<1)return"Todavia no se han agregado piezas al pedido";let m=k.process(i.value);return`${m===void 0?"¿?":m.toLocaleString(Intl.Locale,{style:"percent"})}`}function $(){return i.value.id!==void 0}const l=G({invalid:[],id:[],client:[],orderDate:[],pieces:[]});function B(m){l.value.pieces[m]===void 0&&(l.value.pieces[m]={id:[],dimensions:{length:[],width:[],thickness:[]},color:[]})}function P(){i.value.pieces.push({order:i.value.id,dimensions:{},bothFaces:!1,cut:!1})}const g=A(()=>{let m=!0;for(let e in l.value){if(e==="pieces"){l.value[e].forEach(t=>{for(let c in t){if(c==="dimensions")for(let x in t[c])t[c][x].length>0&&(m=!1);t[c].length>0&&(m=!1)}});continue}l.value[e].length>0&&(m=!1)}return m});function s(){delete l.value.invalid,i.value.id===void 0||!Number.isInteger(i.value.id)?l.value.id=['Genera un Número de pedido usando el botón de "Generar" y consta de números enteros']:l.value.id=[],typeof i.value.client!="string"||i.value.client.length<5?l.value.client=["Se debe poner el nombre y apellidos de cliente y debe tener como mínimo 5 letras"]:l.value.client=[];const m=new Date(i.value.orderDate);isNaN(m.getTime())||new Date().getTime()<m.getTime()?l.value.orderDate=["La fecha no tiene un formato válido y no puede ser una fecha posterior a la fecha actual"]:l.value.orderDate=[],i.value.pieces.length<1?l.value.piecesEmpty=["Se debe poner como mínimo una pieza en el pedido"]:l.value.piecesEmpty=[],i.value.pieces.length>0&&i.value.pieces.forEach((e,t)=>{e.id===void 0||!Number.isInteger(e.id)?l.value.pieces[t].id=['Genera un Número para pieza usando el botón de "Generar"']:l.value.pieces[t].id=[],typeof e.color!="string"||e.color.length<3?l.value.pieces[t].color=['Se debe poner un color para el chapado, por ejemplo "natural"']:l.value.pieces[t].color=[],e.dimensions.length===void 0||!Number.isInteger(e.dimensions.length)||e.dimensions.length<1?l.value.pieces[t].dimensions.length=["El largo de la pieza tiene que estar definido ser un número entero y mayor que 0"]:l.value.pieces[t].dimensions.length=[],e.dimensions.width===void 0||!Number.isInteger(e.dimensions.width)||e.dimensions.width<1?l.value.pieces[t].dimensions.width=["El ancho de la pieza tiene que estar definido ser un número entero y mayor que 0"]:l.value.pieces[t].dimensions.width=[],e.dimensions.thickness===void 0||!Number.isInteger(e.dimensions.thickness)||e.dimensions.thickness<1?l.value.pieces[t].dimensions.thickness=["El grosor de la pieza tiene que estar definido ser un número entero y mayor que 0"]:l.value.pieces[t].dimensions.thickness=[]})}function w(){k.add(i.value),S.push({name:"order_details",params:{id:i.value.id}})}return z.title=E?"Editar pedido":"Crear pedido",(m,e)=>{var t,c,x;return a(),p(U,null,[!g.value&&!l.value.invalid?(a(),M(W,{key:0,type:"error"},{title:b(()=>e[9]||(e[9]=[V(" El formulario contiene errores ")])),default:b(()=>[(a(!0),p(U,null,D(l.value,(o,d)=>(a(),p("div",ae,[d!=="pieces"?(a(!0),p(U,{key:0},D(o,r=>(a(),p("div",null,F(r),1))),256)):I("",!0)]))),256))]),_:1})):I("",!0),n("form",ue,[e[19]||(e[19]=n("h2",{class:"col-span-full"},"Datos del pedido",-1)),n("div",me,[e[11]||(e[11]=n("label",{for:"order_id"},"Nº de pedido",-1)),q(E)?(a(),M(f,{key:0,type:"number",readonly:"",class:"rounded-lg flex-1",id:"order_id",modelValue:i.value.id,"onUpdate:modelValue":e[0]||(e[0]=o=>i.value.id=o)},null,8,["modelValue"])):(a(),p("div",pe,[u(f,{error:l.value.id.length>0,type:"number",readonly:"",class:"rounded-l-lg flex-1",id:"order_id",modelValue:i.value.id,"onUpdate:modelValue":e[1]||(e[1]=o=>i.value.id=o)},null,8,["error","modelValue"]),u(N,{class:"rounded-r-lg",onClick:e[2]||(e[2]=o=>T()),disabled:i.value.id!==void 0},{default:b(()=>e[10]||(e[10]=[V("Generar")])),_:1},8,["disabled"])]))]),n("div",ce,[e[12]||(e[12]=n("label",{for:"order_client"},"Cliente",-1)),u(f,{error:l.value.client.length>0,type:"text",class:"rounded-lg flex-1",id:"order_client",modelValue:i.value.client,"onUpdate:modelValue":e[3]||(e[3]=o=>i.value.client=o)},null,8,["error","modelValue"])]),n("div",fe,[e[13]||(e[13]=n("label",{for:"order_date"},"Fecha pedido",-1)),u(f,{error:l.value.orderDate.length>0,type:"datetime-local",class:"rounded-lg flex-1",id:"order_date",modelValue:i.value.orderDate,"onUpdate:modelValue":e[4]||(e[4]=o=>i.value.orderDate=o)},null,8,["error","modelValue"])]),n("div",ve,[e[14]||(e[14]=n("label",null,"Procesado",-1)),n("div",ge,F(C()),1)]),n("div",he,[u(f,{type:"checkbox",class:"rounded-lg",id:"order_served",modelValue:i.value.served,"onUpdate:modelValue":e[5]||(e[5]=o=>i.value.served=o)},null,8,["modelValue"]),e[15]||(e[15]=n("label",{for:"order_served"},"Servido",-1))]),e[20]||(e[20]=n("h3",{class:"col-span-full"},"Piezas encargadas",-1)),n("div",be,[u(N,{onClick:e[6]||(e[6]=o=>P()),"button-style":$()?"success":"warning",class:"rounded-lg",icon:!0,disabled:!$()},{default:b(()=>[u(J,{width:"24"}),V(" "+F($()?"Añadir pieza":"Crea un ID para el pedido"),1)]),_:1},8,["button-style","disabled"]),((c=(t=l.value)==null?void 0:t.piecesEmpty)==null?void 0:c.length)>0?(a(),p("div",ye,F(l.value.piecesEmpty[0]),1)):I("",!0)]),n("div",Ve,[(a(!0),p(U,null,D(i.value.pieces,(o,d)=>(a(),p("div",{key:d,class:"grid grid-cols-3 gap-3 py-3"},[V(F(B(d))+" ",1),u(re,{isEdit:q(E),id:o.id,"onUpdate:id":r=>o.id=r,"dimensions-length":o.dimensions.length,"onUpdate:dimensionsLength":r=>o.dimensions.length=r,"dimensions-width":o.dimensions.width,"onUpdate:dimensionsWidth":r=>o.dimensions.width=r,"dimensions-thickness":o.dimensions.thickness,"onUpdate:dimensionsThickness":r=>o.dimensions.thickness=r,color:o.color,"onUpdate:color":r=>o.color=r,"both-faces":o.bothFaces,"onUpdate:bothFaces":r=>o.bothFaces=r,cut:o.cut,"onUpdate:cut":r=>o.cut=r,errors:l.value.pieces[d],"onUpdate:errors":r=>l.value.pieces[d]=r},null,8,["isEdit","id","onUpdate:id","dimensions-length","onUpdate:dimensionsLength","dimensions-width","onUpdate:dimensionsWidth","dimensions-thickness","onUpdate:dimensionsThickness","color","onUpdate:color","both-faces","onUpdate:bothFaces","cut","onUpdate:cut","errors","onUpdate:errors"])]))),128))]),n("div",ke,[e[18]||(e[18]=n("div",{class:"flex-1"},null,-1)),u(N,{class:"rounded-lg",onClick:e[7]||(e[7]=o=>s())},{default:b(()=>e[16]||(e[16]=[V("Validar datos")])),_:1}),u(N,{"button-style":"success",class:"rounded-lg",disabled:!g.value||((x=l.value.invalid)==null?void 0:x.length)===0,onClick:e[8]||(e[8]=o=>w())},{default:b(()=>e[17]||(e[17]=[V("Guardar pedido")])),_:1},8,["disabled"])])])],64)}}};export{we as default};
//# sourceMappingURL=add-BFlq1bbj.js.map
