{"version":3,"file":"add-nre9Q8xY.js","sources":["../../src/views/orders/piece.vue","../../src/views/orders/add.vue"],"sourcesContent":["<script setup>\nimport Input from '@/components/forms/input.vue'\nimport Button from '@/components/forms/button.vue'\nimport { usePiecesStore } from '@/stores/pieces'\n\nconst store = usePiecesStore()\n\n// const model = defineModel({\n// \tbothFaces,\n// \tcut\n// })\n\nconst props = defineProps({\n\tisEdit: Boolean\n})\n\nconst id = defineModel('id')\nconst order = defineModel('order')\nconst dimensionsLength = defineModel('dimensionsLength')\nconst dimensionsWidth = defineModel('dimensionsWidth')\nconst dimensionsThickness = defineModel('dimensionsThickness')\nconst color = defineModel('color')\nconst bothFaces = defineModel('bothFaces', {\n\ttype: Boolean,\n\tset (value) {\n\t\tvalue = Boolean(value)\n\t\treturn value\n\t}\n})\nconst cut = defineModel('cut', {\n\ttype: Boolean,\n\tset (value) {\n\t\tvalue = Boolean(value)\n\t\treturn value\n\t}\n})\n\nfunction generatePieceId() {\n\tid.value =  store.generatePieceId()\n}\n</script>\n\n<template>\n\t<input type=\"hidden\" v-model=\"order\">\n\t<div class=\"col-span-2 flex gap-3 items-center\">\n\t\t<label for=\"piece_id\">Nº de pedido</label>\n\t\t<Input v-if=\"props.isEdit\" type=\"number\" readonly class=\"rounded-lg flex-1\" id=\"piece_id\" v-model=\"id\" />\n\t\t<template v-else>\n\t\t\t<div class=\"flex-1 flex gap-0\">\n\t\t\t\t<Input type=\"number\" readonly class=\"rounded-l-lg flex-1\" id=\"piece_id\" v-model=\"id\" />\n\t\t\t\t<Button class=\"rounded-r-lg\" @click=\"generatePieceId()\" :disabled=\"id !== undefined\">Generar</Button>\n\t\t\t</div>\n\t\t</template>\n\t</div>\n\n\t<div class=\"col-span-full\">\n\t\t<h5>Dimensiones</h5>\n\t\t<div class=\"col-span-full grid grid-cols-3 gap-3\">\n\t\t\t<div class=\"flex gap-3 items-center\">\n\t\t\t\t<label for=\"piece_dimensions_length\">Largo (cm)</label>\n\t\t\t\t<Input class=\"rounded-lg flex-1\" type=\"number\" id=\"piece_dimensions_length\" v-model=\"dimensionsLength\" step=\"1\" />\n\t\t\t</div>\n\t\t\t<div class=\"flex gap-3 items-center\">\n\t\t\t\t<label for=\"piece_dimensions_width\">Ancho (cm)</label>\n\t\t\t\t<Input class=\"rounded-lg flex-1\" type=\"number\" id=\"piece_dimensions_width\"  v-model=\"dimensionsWidth\" step=\"1\" />\n\t\t\t</div>\n\t\t\t<div class=\"flex gap-3 items-center\">\n\t\t\t\t<label for=\"piece_dimensions_thickness\">Grosor (cm)</label>\n\t\t\t\t<Input class=\"rounded-lg flex-1\" type=\"number\" id=\"piece_dimensions_thickness\"  v-model=\"dimensionsThickness\" step=\"1\" />\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div class=\"flex gap-3 items-center\">\n\t\t<label for=\"piece_color\">Color chapado</label>\n\t\t<Input class=\"rounded-lg flex-1\" type=\"text\" id=\"piece_color\" v-model=\"color\" />\n\t</div>\n\t\n\t<div class=\"flex gap-3 items-center\">\n\t\t<Input type=\"checkbox\" id=\"piece_bothFaces\" v-model=\"bothFaces\" />\n\t\t<label for=\"piece_bothFaces\">¿Ambas caras?</label>\n\t</div>\n\n\t<div class=\"flex gap-3 items-center\">\n\t\t<Input type=\"checkbox\" id=\"piece_cut\" v-model=\"cut\" />\n\t\t<label for=\"piece_cut\">¿Cortada?</label>\n\t</div>\n</template>\n","<script setup>\nimport Input from '@/components/forms/input.vue'\nimport Button from '@/components/forms/button.vue'\nimport Add from '@/components/icons/add.vue'\nimport AddPiece from './piece.vue'\nimport Alert from '@/components/dialogs/alert.vue'\n\nimport { useOrdersStore } from '@/stores/orders'\nimport { usePageTitleStore } from '@/stores/page-title'\nimport { computed, ref } from 'vue'\nimport { useRouter } from 'vue-router'\n\nconst router = useRouter()\nconst pageStore = usePageTitleStore()\n\nconst props = defineProps({\n\tid: String\n})\n\nconst store = useOrdersStore()\n\nconst order = ref(store.find(props.id))\norder.value.served = order.value.serverd === undefined ? false : true\n\nfunction generateOrderId() {\n\torder.value.id = store.generateOrderId()\n}\n\nfunction checkIsEdit() {\n\treturn ! (order.value.id === undefined)\n}\n\nconst isEdit = checkIsEdit()\n\nfunction process() {\n\tif (order.value?.pieces?.length < 1) {\n\t\treturn 'Todavia no se han agregado piezas al pedido'\n\t}\n\n\tlet num = store.process(order.value)\n\tlet percent = num === undefined ? '¿?' : num.toLocaleString(Intl.Locale, { style: 'percent' })\n\n\treturn `${percent}`\n}\n\nfunction canAddPieces() {\n\treturn ! (order.value.id === undefined)\n}\n\nfunction addPiece() {\n\torder.value.pieces.push({\n\t\torder: order.value.id,\n\t\tdimensions: {},\n\t\tbothFaces: false,\n\t\tcut: false\n\t})\n}\n\nconst formErrors = ref({invalid: []})\n\nconst isValid = computed((s) => Object.keys(formErrors.value).length < 1)\n\nfunction validate() {\n\tdelete formErrors.value.invalid\n\n\t// Validar si existe un ID\n\tif (order.value.id === undefined) {\n\t\tformErrors.value.id = [\n\t\t\t'Genera un Número de pedido usando el botón de \"Generar\"'\n\t\t]\n\t} else {\n\t\tdelete formErrors.value.id\n\t}\n\n\t// Validar cliente\n\tif (typeof order.value.client !== 'string' || order.value.client.length < 5) {\n\t\tformErrors.value.client = [\n\t\t\t'Se debe poner el nombre y apellidos de cliente y debe tener como mínimo 5 letras'\n\t\t]\n\t} else {\n\t\tdelete formErrors.value.client\n\t}\n\n\t// Validar la fecha\n\tconst date = new Date(order.value.orderDate)\n\n\tif (isNaN(date.getTime()) || new Date().getTime() < date.getTime()) {\n\t\tformErrors.value.orderDate = [\n\t\t\t'La fecha no tiene un formato válido',\n\t\t\t'La fecha puede que sea posterior a la fecha actual'\n\t\t]\n\t} else {\n\t\tdelete formErrors.value.orderDate\n\t}\n\n\t// Validar las piezas\n\tif (order.value.pieces.length < 1) {\n\t\tformErrors.value.piecesEmpty = [\n\t\t\t'Se debe poner como mínimo una pieza en el pedido'\n\t\t]\n\t} else {\n\t\tdelete formErrors.value.piecesEmpty\n\t}\n}\n\nfunction addOrder() {\n\tstore.add(order.value)\n\n\trouter.push({name: 'order_details', params: { id: order.value.id }})\n}\n\npageStore.title = isEdit ? 'Editar pedido' : 'Crear pedido'\n</script>\n\n<template>\n\t<Alert type=\"error\"  v-if=\"!isValid && !formErrors.invalid\">\n\t\t<template #title>\n\t\t\tEl formulario contiene errores\n\t\t</template>\n\t\t<div v-for=\"messages in formErrors\" class=\" space-y-1\">\n\t\t\t<template v-for=\"msg in messages\">{{ msg }}<br /></template>\n\t\t</div>\n\t</Alert>\n\n\t<form class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n\t\t<h2 class=\"col-span-full\">Datos del pedido</h2>\n\n\t\t<div class=\"flex gap-3 items-center\">\n\t\t\t<label for=\"order_id\">Nº de pedido</label>\n\t\t\t<Input v-if=\"isEdit\" type=\"number\" readonly class=\"rounded-lg flex-1\" id=\"order_id\" v-model=\"order.id\" />\n\t\t\t<template v-else>\n\t\t\t\t<div class=\"flex-1 flex gap-0\">\n\t\t\t\t\t<Input :error=\"formErrors?.id?.length > 0\" type=\"number\" readonly class=\"rounded-l-lg flex-1\" id=\"order_id\" v-model=\"order.id\" />\n\t\t\t\t\t<Button class=\"rounded-r-lg\" @click=\"generateOrderId()\" :disabled=\"order.id !== undefined\">Generar</Button>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t\t<div class=\"flex gap-3 items-center\">\n\t\t\t<label for=\"order_client\">Cliente</label>\n\t\t\t<Input :error=\"formErrors?.client?.length > 0\" type=\"text\" class=\"rounded-lg flex-1\" id=\"order_client\" v-model=\"order.client\" />\n\t\t</div>\n\t\t\n\t\t<div class=\"flex gap-3 items-center\">\n\t\t\t<label for=\"order_date\">Fecha pedido</label>\n\t\t\t<Input :error=\"formErrors?.orderDate?.length > 0\" type=\"datetime-local\" class=\"rounded-lg flex-1\" id=\"order_date\" v-model=\"order.orderDate\" />\n\t\t</div>\n\t\t<div class=\"flex gap-3 items-center\">\n\t\t\t<label>Procesado</label>\n\t\t\t<div class=\"flex-1\">\n\t\t\t\t{{ process() }}\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"flex gap-3 items-center\">\n\t\t\t<Input type=\"checkbox\" class=\"rounded-lg\" id=\"order_served\" v-model=\"order.served\" />\n\t\t\t<label for=\"order_served\">Servido</label>\n\t\t</div>\n\n\t\t<h3 class=\"col-span-full\">Piezas encargadas</h3>\n\n\t\t<div class=\"col-span-full flex items-center gap-3\">\n\t\t\t<Button \n\t\t\t\t@click=\"addPiece()\"\n\t\t\t\t:button-style=\"canAddPieces() ? 'success' : 'warning'\" \n\t\t\t\tclass=\"rounded-lg\" \n\t\t\t\t:icon=\"true\" \n\t\t\t\t:disabled=\"!canAddPieces()\"\n\t\t\t>\n\t\t\t\t<Add width=\"24\" /> \n\t\t\t\t{{ canAddPieces() ? 'Añadir pieza' : 'Crea un ID para el pedido' }}\n\t\t\t</Button>\n\n\t\t\t<div class=\"flex-1 text-red-700\" v-if=\"formErrors?.piecesEmpty?.length > 0\">\n\t\t\t\t{{ formErrors.piecesEmpty[0] }}\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"col-span-full grid grid-cols-1 divide-y-2 divide-gold-sand-500\">\n\t\t\t<div v-for=\"(piece, index) in order.pieces\" :key=\"index\" class=\"grid grid-cols-3 gap-3 py-3\">\n\t\t\t\t<AddPiece \n\t\t\t\t\t:isEdit=\"isEdit\"\n\t\t\t\t\tv-model:id=\"piece.id\" \n\t\t\t\t\tv-model:dimensions-length=\"piece.dimensions.length\"\n\t\t\t\t\tv-model:dimensions-width=\"piece.dimensions.width\"\n\t\t\t\t\tv-model:dimensions-thickness=\"piece.dimensions.thickness\"\n\t\t\t\t\tv-model:color=\"piece.color\"\n\t\t\t\t\tv-model:both-faces=\"piece.bothFaces\"\n\t\t\t\t\tv-model:cut=\"piece.cut\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"col-span-full flex gap-3 mb-3\">\n\t\t\t<div class=\"flex-1\"></div>\n\t\t\t<Button class=\"rounded-lg\" @click=\"validate()\">Validar datos</Button>\n\n\t\t\t<Button button-style=\"success\" class=\"rounded-lg\" :disabled=\"!isValid\" @click=\"addOrder()\">Guardar pedido</Button>\n\t\t</div>\n\t</form>\n</template>\n"],"names":["store","usePiecesStore","props","__props","id","_useModel","order","dimensionsLength","dimensionsWidth","dimensionsThickness","color","bothFaces","value","cut","generatePieceId","router","useRouter","pageStore","usePageTitleStore","useOrdersStore","ref","generateOrderId","checkIsEdit","isEdit","process","_b","_a","num","canAddPieces","addPiece","formErrors","isValid","computed","s","validate","date","addOrder"],"mappings":"uqCAKA,MAAMA,EAAQC,EAAc,EAOtBC,EAAQC,EAIRC,EAAKC,EAAWF,EAAC,IAAI,EACrBG,EAAQD,EAAYF,EAAA,OAAO,EAC3BI,EAAmBF,EAAYF,EAAA,kBAAkB,EACjDK,EAAkBH,EAAWF,EAAC,iBAAiB,EAC/CM,EAAsBJ,EAAYF,EAAA,qBAAqB,EACvDO,EAAQL,EAAYF,EAAA,OAAO,EAC3BQ,EAAYN,EAAWF,EAAC,YAAa,CAE1C,IAAKS,EAAO,CACX,OAAAA,EAAQ,EAAQA,EACTA,CACT,CACA,CAAC,EACKC,EAAMR,IAAY,MAAO,CAE9B,IAAKO,EAAO,CACX,OAAAA,EAAQ,EAAQA,EACTA,CACT,CACA,CAAC,EAED,SAASE,GAAkB,CAC1BV,EAAG,MAASJ,EAAM,gBAAe,CAClC,uvFC3BA,MAAMe,EAASC,EAAS,EAClBC,EAAYC,EAAiB,EAE7BhB,EAAQC,EAIRH,EAAQmB,EAAc,EAEtBb,EAAQc,EAAIpB,EAAM,KAAKE,EAAM,EAAE,CAAC,EACtCI,EAAM,MAAM,OAASA,EAAM,MAAM,UAAY,OAE7C,SAASe,GAAkB,CAC1Bf,EAAM,MAAM,GAAKN,EAAM,gBAAe,CACvC,CAEA,SAASsB,GAAc,CACtB,OAAUhB,EAAM,MAAM,KAAO,MAC9B,CAEA,MAAMiB,EAASD,EAAW,EAE1B,SAASE,GAAU,SAClB,KAAIC,GAAAC,EAAApB,EAAM,QAAN,YAAAoB,EAAa,SAAb,YAAAD,EAAqB,QAAS,EACjC,MAAO,8CAGR,IAAIE,EAAM3B,EAAM,QAAQM,EAAM,KAAK,EAGnC,MAAO,GAFOqB,IAAQ,OAAY,KAAOA,EAAI,eAAe,KAAK,OAAQ,CAAE,MAAO,SAAW,CAAA,CAE5E,EAClB,CAEA,SAASC,GAAe,CACvB,OAAUtB,EAAM,MAAM,KAAO,MAC9B,CAEA,SAASuB,GAAW,CACnBvB,EAAM,MAAM,OAAO,KAAK,CACvB,MAAOA,EAAM,MAAM,GACnB,WAAY,CAAE,EACd,UAAW,GACX,IAAK,EACL,CAAA,CACF,CAEA,MAAMwB,EAAaV,EAAI,CAAC,QAAS,EAAE,CAAC,EAE9BW,EAAUC,EAAUC,GAAM,OAAO,KAAKH,EAAW,KAAK,EAAE,OAAS,CAAC,EAExE,SAASI,GAAW,CACnB,OAAOJ,EAAW,MAAM,QAGpBxB,EAAM,MAAM,KAAO,OACtBwB,EAAW,MAAM,GAAK,CACrB,yDACH,EAEE,OAAOA,EAAW,MAAM,GAIrB,OAAOxB,EAAM,MAAM,QAAW,UAAYA,EAAM,MAAM,OAAO,OAAS,EACzEwB,EAAW,MAAM,OAAS,CACzB,kFACH,EAEE,OAAOA,EAAW,MAAM,OAIzB,MAAMK,EAAO,IAAI,KAAK7B,EAAM,MAAM,SAAS,EAEvC,MAAM6B,EAAK,QAAO,CAAE,GAAK,IAAI,KAAM,EAAC,QAAS,EAAGA,EAAK,UACxDL,EAAW,MAAM,UAAY,CAC5B,sCACA,oDACH,EAEE,OAAOA,EAAW,MAAM,UAIrBxB,EAAM,MAAM,OAAO,OAAS,EAC/BwB,EAAW,MAAM,YAAc,CAC9B,kDACH,EAEE,OAAOA,EAAW,MAAM,WAE1B,CAEA,SAASM,GAAW,CACnBpC,EAAM,IAAIM,EAAM,KAAK,EAErBS,EAAO,KAAK,CAAC,KAAM,gBAAiB,OAAQ,CAAE,GAAIT,EAAM,MAAM,GAAI,CAAC,CACpE,CAEA,OAAAW,EAAU,MAAQM,EAAS,gBAAkB"}